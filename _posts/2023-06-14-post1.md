---
layout: post
title:  "í† ë¹„ì˜ ìŠ¤í”„ë§ - 2-4ì¥ ìŠ¤í”„ë§ @MVC 2 "
date:   2023-06-14
categories: Spring
tags : í† ë¹„ì˜ìŠ¤í”„ë§
---


# 4.5 ë©”ì„¸ì§€ ì»¨ë²„í„°ì™€ AJAX

---

GET - `@RequestParam`, `@ModelAttribute` 

POST - `@RequestBody`

## 4.5.1 ë©”ì‹œì§€ ì»¨ë²„í„° ì¢…ë¥˜

---

ë©”ì„¸ì§€ ì»¨ë²„í„°ëŠ” `RequestMappingHandlerAdpater`ë¥¼ í†µí•´ ë“±ë¡ëœë‹¤.

### ìŠ¤í”„ë§

ìŠ¤í”„ë§ì€ classpathì— í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¡´ì¬í•˜ë©´ `MessageConverter`ë¥¼ ìë™ìœ¼ë¡œ ë“±ë¡í•´ì¤€ë‹¤.

- `Jaxb2RootElementHttpMessageConverter`, `MappingJackson2HttpMessageConverter` ë“±

```java
static {
  ClassLoader classLoader = WebMvcConfigurationSupport.class.getClassLoader();
  romePresent = ClassUtils.isPresent("com.rometools.rome.feed.WireFeed", classLoader);
  jaxb2Present = ClassUtils.isPresent("javax.xml.bind.Binder", classLoader);
  jackson2Present = ClassUtils.isPresent("com.fasterxml.jackson.databind.ObjectMapper", classLoader) &&
      ClassUtils.isPresent("com.fasterxml.jackson.core.JsonGenerator", classLoader);
  jackson2XmlPresent = ClassUtils.isPresent("com.fasterxml.jackson.dataformat.xml.XmlMapper", classLoader);
  jackson2SmilePresent = ClassUtils.isPresent("com.fasterxml.jackson.dataformat.smile.SmileFactory", classLoader);
  jackson2CborPresent = ClassUtils.isPresent("com.fasterxml.jackson.dataformat.cbor.CBORFactory", classLoader);
  gsonPresent = ClassUtils.isPresent("com.google.gson.Gson", classLoader);
  jsonbPresent = ClassUtils.isPresent("javax.json.bind.Jsonb", classLoader);
  kotlinSerializationJsonPresent = ClassUtils.isPresent("kotlinx.serialization.json.Json", classLoader);
}
```

### ìŠ¤í”„ë§ ë¶€íŠ¸

Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ê¸°ë³¸ìœ¼ë¡œ í¬í•¨ë˜ì–´ ìˆì–´ ìë™ìœ¼ë¡œ `MappingJackson2HttpMessageConverter` ë¥¼ ì‚¬ìš©í•˜ì—¬ http ìš”ì²­ë³¸ë¬¸ì„ JSONìœ¼ë¡œ ë³€í™˜í•´ ì¤„ ìˆ˜ ìˆë‹¤.

- ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ `WebMvcAutoConfiguration`

  ```java
  public class HttpMessageConverters implements Iterable<HttpMessageConverter<?>> {
    ....
    static {
      List<Class<?>> nonReplacingConverters = new ArrayList<>();
      addClassIfExists(nonReplacingConverters,
          "org.springframework.hateoas.server.mvc.TypeConstrainedMappingJackson2HttpMessageConverter");
      NON_REPLACING_CONVERTERS = Collections.unmodifiableList(nonReplacingConverters);
    }
    ...
    static {
      Map<Class<?>, Class<?>> equivalentConverters = new HashMap<>();
      putIfExists(equivalentConverters, 
      "org.springframework.http.converter.json.MappingJackson2HttpMessageConverter",
          "org.springframework.http.converter.json.GsonHttpMessageConverter");
      EQUIVALENT_CONVERTERS = Collections.unmodifiableMap(equivalentConverters);
    }
  }
  ```

### `MappingJackson2HttpMessageConverter`

- `Jackson ObjectMapper`ë¥¼ ì´ìš©í•´ì„œ ìë°”ì˜¤ë¸Œì íŠ¸ì™€ JSONì„ ìë™ë³€í™˜í•´ì£¼ëŠ” ë©”ì„¸ì§€ ì»¨ë²„í„°
- ì§€ì› ë¯¸ë””ì–´ íƒ€ì…ì€ `application/json`
- ìë°” íƒ€ì…ì— ì œí•œì€ ì—†ì§€ë§Œ, í”„ë¡œí¼í‹°ë¥¼ ê°€ì§„ ìë°” ë¹ˆì´ê±°ë‚˜ HashMapì„ ì´ìš©í•´ì•¼ ì •í™•í•œ ë³€í™˜ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.
- ë‚ ì§œ, ìˆ«ì ë“±ì—ì„œ í¬ë§·ì„ ì ìš©í•˜ëŠ” ë¶€ê°€ì ì¸ ë³€í™˜ ê¸°ëŠ¥ì´ í•„ìš”í•˜ë©´ `ObjectMapper`ë¥¼ í™•ì¥í•´ì„œ ì ìš©í•  ìˆ˜ ìˆë‹¤.

# 4.6 MVC ë„¤ì„ìŠ¤í˜ì´ìŠ¤

---

## mvc ìŠ¤í‚¤ë§ˆì˜ íƒœê·¸

---

### mvc:annotation-driven

- ì´ íƒœê·¸ëŠ” ì• ë…¸í…Œì´ì…˜ ë°©ì‹ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‚¬ìš©í•  ë•Œ, í•„ìš”í•œ `DispatcherServlet` ì „ëµë¹ˆì„ ìë™ìœ¼ë¡œ ë“±ë¡ í•´ì¤€ë‹¤.
  - **ì „ìš© íƒœê·¸ì— ì˜í•´ ì¸í”„ë¼ ë¹ˆì´ ë“±ë¡ ë˜ë¯€ë¡œ ê¸°ë³¸ ì „ëµì€ ë¬´ì‹œëœë‹¤!**
-` <mvc:annotation-driven>`ì— ì˜í•´ ìë™ìœ¼ë¡œ ë“±ë¡ë˜ëŠ” ë¹ˆ ì •ë³´
  - í•¸ë“¤ëŸ¬ ë§¤í•‘
      - `RequestMappingHandlerMapping` ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.
      - ë‹¤ë¥¸ ë””í´íŠ¸ í•¸ë“¤ëŸ¬ ë§¤í•‘ ì „ëµì€ ë“±ë¡ë˜ì§€ ì•ŠëŠ”ë‹¤.
  - í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°
      - `RequestMappingHanlderAdapter`ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.
      - ë‹¤ë¥¸ ë””í´íŠ¸ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° ì „ëµì€ ìë™ ë“±ë¡ë˜ì§€ ì•ŠëŠ”ë‹¤.
  - ë©”ì„¸ì§€ ì»¨ë²„í„°
      - `HandlerMappingHandlerAdapter`ì˜ `messageConverters` í”„ë¡œí¼í‹°ë¡œ ë©”ì„¸ì§€ ì»¨ë²„í„°ë“¤ì´ ë“±ë¡ëœë‹¤.
      - 4ê°œì˜ ê¸°ë³¸ ì „ëµì˜ ë©”ì„¸ì§€ ì»¨ë²„í„°ì™€ í•¨ê»˜ í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— jaxb2ì™€ jackson ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¡´ì¬í•˜ë©´ `Jaxb2RootElementHttpMessageConverter`, `MappingJackson2HttpMessageConverter`ê°€ ì¶”ê°€ë¡œ ë“±ë¡ëœë‹¤.
- `RequestMappingHandlerAdpater`ì™€ `RequestMappingHandlerMapping` ë“±ì˜ ì„¤ì •ì„ ë³€ê²½í•´ì•¼ í• ë•ŒëŠ” `mvc:annotation-driven` íƒœê·¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. ì´ë•ŒëŠ” í•„ìš”í•œ ë¹ˆì„ ë“±ë¡í•˜ê³  í”„ë¡œí¼í‹°ë¥¼ í†µí•´ ì„¤ì • í•´ì¤˜ì•¼ í•œë‹¤.
    

### mvc:interceptors

- ëª¨ë“  í•¸ë“¤ëŸ¬ ë§¤í•‘ì— ì¼ê´„ì ìš©ë˜ëŠ” ì¸í„°ì…‰í„°ë¥¼ í•œ ë²ˆì— ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
- URL íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
    
    ```xml
    <mvc:interceptors>
      <mvc:interceptor>
        <mvc:mapping path="/admin/*"/>
        <bean class="..AdminInterceptor"/>
      </mvc:interceptor>
    </mvc:interceptors>
    ```
    

### mvc:view-controller

```xml
<mvc:view-controller path="/" view-name="/index"/>
```

- `<mvc:view-controller>`ë¥¼ í•˜ë‚˜ë¼ë„ ë“±ë¡í•˜ë©´ `SimplelUrlHandlerMapping`ê³¼ `SimpleControllerHandlerAdapter`ë¥¼ ìë™ìœ¼ë¡œ ë“±ë¡í•œë‹¤.

# 4.9 ìŠ¤í”„ë§ 3.1ì˜ @MVC

---

### @RequestMappingì„ ì§€ì›í•˜ëŠ” DispatcherServlet ì „ëµì˜ ë³€í™”

- í•¸ë“¤ëŸ¬ ë§¤í•‘
    - `DefaultAnnotationHandlerMapping` â†’ `RequestMappingHandlerMapping`
    - `@RequestMapping` ì§€ì› í•¸ë“¤ëŸ¬ ë§¤í•‘
- í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°
    - `AnnotationMethodHandlerAdpater` â†’ `RequestMappingHandlerAdpater`
    - `@RequestMapping` ì§€ì› í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°
- í•¸ë“¤ëŸ¬ ìµì…‰ì…˜ ë¦¬ì¡¸ë²„
    - `AnnotationMethodHandlerExceptionResolver` â†’ `ExceptionHandlerExceptionResolver`
    - `@ExceptionHanlder`ë¥¼ ì§€ì›í•˜ëŠ” ì „ëµ í´ë˜ìŠ¤

### ìŠ¤í”„ë§ 3.1 @MVC ë³€í™”ì˜ ê°€ì¥ í° íŠ¹ì§•
* `DispatcherServlet` ì „ëµì´ ì•„ì£¼ ìœ ì—°í•œ í™•ì¥ì„±ì„ ê°€ì§ˆ ìˆ˜ ìˆë„ë¡ ì•„í‚¤í…ì³ê°€ ê°œì„ ë˜ì—ˆë‹¤.

### @RequestMapping ë©”ì†Œë“œì™€ í•¸ë“¤ëŸ¬ ë§¤í•‘ ì „ëµì˜ ë¶ˆì¼ì¹˜

- `@RequestMapping`ì„ ë‹´ë‹¹í•˜ëŠ” `DefaultAnnoationHandlerMapping` ê°™ì€ ì „ëµ í´ë˜ìŠ¤ê°€ `DispatcherServlet` ì „ëµì˜ ì„¤ê³„ ì˜ë„ì™€ ë§ì§€ ì•ŠëŠ” ë¶€ë¶„ì´ ì¡´ì¬ í•˜ì˜€ë‹¤.
- `@RequestMapping`ì€ ì›¹ ìš”ì²­ì„ ì»¨íŠ¸ë¡¤ëŸ¬ ì˜¤ë¸Œì íŠ¸ê°€ ì•„ë‹Œ ì˜¤ë¸Œì íŠ¸ ë‚´ íŠ¹ì • ë©”ì†Œë“œì— ë§¤í•‘í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆë‹¤. (ë©”ì†Œë“œ ë ˆë²¨ì— ë§¤í•‘ì •ë³´ë¥¼ ë„£ëŠ” ì „ëµ)
- `@RequestMapping` ë°©ì‹ì—ì„  ë¦¬í”Œë ‰ì…˜ê³¼ ê°™ì€ ë©”íƒ€ í”„ë¡œê·¸ë˜ë° APIë¥¼ ì´ìš©í•´ì•¼ë§Œ ë©”ì†Œë“œ í˜¸ì¶œì´ ê°€ëŠ¥í•˜ë‹¤.
- ìë°”ì˜ ë©”ì†Œë“œëŠ” ì˜¤ë¸Œì íŠ¸ë¡œ ì·¨ê¸‰ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¹ˆì´ ë ìˆ˜ ì—†ë‹¤.
    - ë©”ì†Œë“œ ë ˆë²¨ì˜ í•¸ë“¤ëŸ¬ì— ì§ì ‘ ë§¤í•‘í•  ë°©ë²•ì´ ì—†ë‹¤ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤.
- `DefaultAnnotationHandlerMapping` ì „ëµ
    - ë§¤í•‘ ê²°ê³¼ê°€ ìš”ì²­ì„ ë‹´ë‹¹í•  ë©”ì†Œë“œê°€ ì†í•´ìˆëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ì˜¤ë¸Œì íŠ¸ì´ë‹¤.
    - `AnnoationHandlerAdpater`ê°€ ì‹¤í–‰ëœ ë©”ì†Œë“œë¥¼ ì°¾ëŠ” ë§¤í•‘ ì‘ì—…ì„ ì¶”ê°€ë¡œ í•´ì•¼ í–ˆì—ˆë‹¤.
    - ğŸ§¨ **í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ê°€ ë§¤í•‘ ì—­í• ì„ ë¶€ë¶„ì ìœ¼ë¡œ ê°€ì§€ê³  ìˆëŠ” ì´ìƒí•œ êµ¬ì¡°ì´ë‹¤.**
  - í•¸ë“¤ëŸ¬ ë§¤í•‘ ì „ëµì—ì„œ ì„¤ì •ëœ í•¸ë“¤ëŸ¬ ì •ë³´ë§Œ ê°€ì§€ê³  ì–´ë–¤ ë©”ì†Œë“œê°€ ì‚¬ìš©ë ì§€ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— í•¸ë“¤ëŸ¬ ì¸í„°ì…‰í„°ì˜ í™œìš©ë„ ì œí•œ ë˜ì—ˆë‹¤.
      - í•¸ë“¤ëŸ¬ ì¸í„°ì…‰í„°ëŠ” í•¸ë“¤ëŸ¬ ë§¤í•‘ì´ ëë‚˜ê³ , ì‹¤ì œ í•¸ë“¤ëŸ¬ ì‹¤í–‰ë˜ê¸° ì „í›„ì— ë™ì‘í•œë‹¤.
        
      ```java
      public boolean preHandle(..Object Handler){
          // ì—¬ê¸°ì„œ ë„˜ì–´ì˜¤ëŠ” handlerëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ì˜¤ë¸Œì íŠ¸ì„
      }
      ```
        
- ìŠ¤í”„ë§ 3.1 ë¶€í„°ëŠ” ì˜ˆì „ì²˜ëŸ¼ ì»¨íŠ¸ë¡¤ëŸ¬ ì˜¤ë¸Œì íŠ¸ê°€ ì•„ë‹ˆë¼ `HandlerMethod`ë¼ëŠ” ìƒˆë¡œìš´ íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ í•¸ë“¤ëŸ¬ë¡œ ë„˜ê²¨ì¤€ë‹¤.
    
    ```java
    public boolean preHandle(...Object handler){
        HandlerMethod hm = (HandlerMethod) handler;
    }
    ```
    

### HandlerMethod

- `RequestMappingHandlerMapping`
    - ì›¹ ìš”ì²­ì„ `HandlerMethod` ì˜¤ë¸Œì íŠ¸ì— ë§¤í•‘í•œë‹¤.
    - `DispatcherServlet`ê°€ ì´ˆê¸°í™” ë  ë•Œ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ë¹ˆì˜ ë©”ì†Œë“œë¥¼ ì‚´í´ì„œ ë§¤í•‘ í›„ë³´ê°€ ë  ë©”ì†Œë“œë¥¼ ì¶”ì¶œí•˜ì—¬ ì´ë¥¼ `HandlerMethod` í˜•íƒœë¡œ ì €ì¥í•œë‹¤.
    - ì‹¤ì œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì €ì¥í•´ë‘” ëª©ë¡ì—ì„œ ìš”ì²­ ì¡°ê±´ì— ë§ëŠ” `HandlerMethod` ì˜¤ë¸Œì íŠ¸ë¥¼ ì°¾ì•„ ëŒë ¤ì¤€ë‹¤.
    - ë§¤í•‘ì˜ ê²°ê³¼ê°€ `HandlerMethod` íƒ€ì…ì˜ ì¶”ìƒí™”ëœ ì˜¤ë¸Œì íŠ¸ í˜•íƒœë¡œ ë§Œë“¤ì–´ì§„ë‹¤.
- `<mvc:annotation-driven>` ì‚¬ìš©ì‹œ  ê¸°ë³¸ì ìœ¼ë¡œ ë“±ë¡ë˜ëŠ” ì „ëµ ë¹ˆ

## 4.9.4 @EnableWebMvcì™€ WebMvcConfigurationSupportë¥¼ ì´ìš©í•œ @MVC ì„¤ì •
ìë°” ì½”ë“œë¥¼ ì´ìš©í•œ @MVC ë¹ˆ ë“±ë¡ ë° ì„¤ì • ë°©ì‹
```
o.s.context.annotation.internalConfigurationAnnotationProcessor
o.s.context.annotation.internalAutowiredAnnotationProcessor
o.s.context.event.internalEventListenerProcessor
o.s.context.event.internalEventListenerFactory

o.s.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping

o.s.format.support.FormattingConversionServiceFactoryBean#0
o.s.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter

o.s.web.servlet.handler.MappedInterceptor#0
o.s.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver#0
o.s.web.servlet.mvc.annotation.ResponseStatusExceptionResolver#0
o.s.web.servlet.mvc.support.DefaultHandlerExceptionResolver#0
o.s.web.servlet.handler.BeanNameUrlHandlerMapping
o.s.web.servlet.mvc.HttpRequestHandlerAdapter
o.s.web.servlet.mvc.SimpleControllerHandlerAdapter
```

---

### @EnableWebMvcì™€ WebMvcConfigurer

```java
@Configuration
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdpater {
}
public class WebMvcConfigurerAdpater implements WebMvcConfigurer {
}
public class WebMvcConfigurerAdpater2 extends WebMvcConfigurationSupport {
}
```

- `WebConfig`ëŠ” ì›¹ ê³„ì¸µìš© ì»¨í…ìŠ¤íŠ¸ì— ë“¤ì–´ê°ˆ ë‚´ìš©ì´ê¸° ë•Œë¬¸ì— ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì„¤ì •ì •ë³´ë¡œ ì í•©í•˜ë‹¤.
- `WebMvcConfigurationSupport` í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ëŠ” ë¹ˆì„ ë“±ë¡
    - `@EnableWebMVC`ì— ì˜í•´ ë“±ë¡ë˜ëŠ” ëª¨ë“  ì „ëµë¹ˆì˜ ë‚´ìš©ì„ `@Bean` ë©”ì†Œë“œë¡œ ê°–ê³  ìˆëŠ” í´ë˜ìŠ¤ ì´ë‹¤. (ë°˜ë©´ `WebMVCConfigurer`ëŠ” ì§ì ‘ @MVC ê´€ë ¨ ë¹ˆì„ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì€ ì—†ë‹¤)
    - `RequestMappingHandlerMapping` ì „ëµ ë¹ˆì´ë‚˜ `RequestMappingHandlerAdpater` ì „ëµ ë¹ˆ ë“±ì„ ì§ì ‘ ì •ì˜í•˜ê³  ìˆëŠ” @Bean ë©”ì†Œë“œê°€ ìˆë‹¤.

### @MVC ì „ëµìš© ì„¤ì • ë¹ˆ ë“±ë¡

- `WebConfigurer`ë¥¼ í†µí•´ì„œëŠ” ë“±ë¡ë˜ì§€ ì•Šì€ @MVC ê´€ë ¨ ë¹ˆë„ ì¡´ì¬
- ëŒ€í‘œì ìœ¼ë¡œ `InternalResourceViewResolver` ë¹ˆì´ë‹¤.

```java
public class WebConifg {
  @Bean
  public InternalResourceViewResolver viewResolver() {
      InternalResourceViewResolver resolver = new InternalResourceViewResolver();
      resolver.setPrefix("/WEB-INF/views/");
      resolver.setSuffix(".jsp");
      return resolver;
  }
}
```
### [ì°¸ê³ ] ###
ë·°, ë·° ë¦¬ì¡¸ë²„, ì§€ì—­ì •ë³´ ë¦¬ì¡¸ë²„, ë©€í‹°íŒŒíŠ¸ ë¦¬ì¡¸ë²„, ë©”ì„¸ì§€ ì†ŒìŠ¤ ì²˜ëŸ¼ ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì— ë¹ˆ í˜•íƒœë¡œ ë“±ë¡í•´ì¤˜ì•¼ í•˜ëŠ” ê²ƒë“¤ì€ ëª¨ë‘ @Bean ë©”ì†Œë“œë¥¼ ì´ìš©í•´ ë“±ë¡í•  ìˆ˜ìˆë‹¤.
