---
layout: post
title:  "토비의 스프링 - 8장 스프링이란 무엇인가?"
date:   2023-06-09
categories: Spring
tags : 토비의스프링
---

# 8.3 POJO 프로그래밍

---

**스프링의 POJO 방식의 개발을 돕기위해 IoC/DI, AOP, PSA와 같은 가능기술을 프레임워크와 컨테이너라는 방식을 통해 제공한다.**

## 8.3.1 스프링의 핵심 POJO

---

![Untitled](/assets/images/posts/2023-06-09-post1/Untitled.png)

스프링의 주요 기술인 **IoC/DI, AOP, PSA**는 애플리케이션을 POJO로 개발할 수 있게 해주는 가능 기술이라고 불린다.

## 8.3.3 POJO의 조건

---

### 특정 규약에 종속되지 않는다.

POJO는 자바 언어와 꼭 필요한 API 외에는 종속되지 않아야 한다. 특정 규약을 따라 만들게 하는 경우는 대부분 규약에서 제시하는 특정 클래스를 상속하도록 요구한다. 객체지향 설계의 자유로운 적용이 가능한 오브젝트여야만 POJO라 불릴 수 있다.

### 특정 환경에 종속되지 않는다.

특정 비지니스 로직을 담고 있는 POJO 클래스는 웹이라는 환경정보나 웹 기술을 담고 있는 클래스나 인터페이스를 사용해서는 안된다. (웹이라는 환경으로 제한 해버리는 오브젝트나 API에 의존하기 때문이다.)

- 비지니스 로직을 담은 코드에 `HttpServletRequest`나 `HttpSession`, 캐시와 관련된 API가 등장하거나 웹 프레임워크의 클래스를 직접 이용하는 부분이 있다면 그것은 진정한 POJO라 볼 수 없다.

진정한 POJO란 객체지향적인 원리에 충실하면서, 환경과 기술에 종속되지 않고 필요에 따라 재활용 될 수 있는 방식으로 설계된 오브젝트를 말한다.

# 8.4 스프링의 기술

---

스프링의 기술들은 스프링 프레임워크가 만들어진 진정한 목표인 POJO 기반 엔터프라이즈 개발을 편리하게 해주는 도구일 뿐이다.

## 8.4.1 제어의 역전 / 의존 관계 주입 (IoC / DI)

---

나머지 두가지 기술인 AOP와 PSA도 IOC/DI에 바탕을 두고 있다. 자주 등장하는 템플릿 / 콜백 패턴이 적용된 부분도 IOC/DI가 핵심 원리다. 

- 두 개의 오브젝트를 분리해서 만들고, 인터페이스를 두고 느슨하게 연결한 뒤, 실제 사용할 대상은 DI를 통해 외부에서 주입하는 것이 핵심이다.
- “유연한 확장"이 핵심 목적이다.

### DI 활용 방법

- 핵심기능의 변경
    - 의존 대상의 구현을 외부에서 바꾼다.
    - 전략 패턴
        - A → B 구조에서 B의 구현 방식을 필요에 따라 B1, B2, B3로 바꿀 수 있다.
- 부가기능의 추가
    - 데코레이터 패턴
    - AOP
- 인터페이스 변경
    - PSA는 클라이언트가 일관성 있게 사용할 수 있는 인터페이스를 정의해주고 DI를 통해 어댑터 역할을 하는 오브젝트를 이용하게 해준다.
- 프록시
- 템플릿과 콜백
    - 반복적으로 등장하지만 항상 고정적인 작업 흐름과 그 사이에 자주 바뀌는 부분을 분리해서 템플릿과 콜백으로 만들고 이를 DI 원리를 응용해서 구성한다.
- 싱글톤과 오브젝트 스코프
    - DI를 프레임워크로 사용한다는 것은 DI 되는 오브젝트의 생명주기를 DI 컨테이너가 제어할 수 있다는 의미도 내포하고 있다.
- 고립된 테스트
    - DI를 위해 만든 수정자 메소드를 사용하면 테스트 코드 안에서 수동적으로 목 오브젝트를 주입할 수 있다.

## 8.4.2 에스팩트 지향 프로그래밍 (AOP)

---

스프링의 목적인 POJO만으로 선언적인 엔터프라이즈 애플리케이션을 개발하면서도 엔터프라이즈 서비스를 선언적으로 제공하는 데 반드시 필요한 것이 AOP 기술이다.

→ [높은 응집도] 공통 관심사를 따로 횡단 분리하여 관리

### AOP의 적용 기법

- 다이내믹 프록시
    - 기존 코드에 영향을 주지 않고 부가기능을 적용하게 해주는 데코레이터 패턴을 응용한 것 이다.
    - 인터페이스와 DI를 활용하는 데코레이터 패턴이 기반이다.
    - **스프링의 기본 AOP 구현 방법은 다이내믹 프록시를 이용하는 프록시 AOP 방식이다.**
- **AspectJ**
    - AspectJ는 **프록시 방식의 AOP에서는 불가능한** 다양한 조인 포인트를 제공한다.
        - 특정 조건에 맞는 대상에 시점별로(실행 전, 실행 후, 정상 실행 후 예외 발생 후, 모든 시점) 일괄 적용 가능하다.
    - 메소드 호출 뿐만 아니라 인스턴스 생성, 필드 액세스, 특정 호출 경로를 가진 메소드 호출도 가능하다.

### AOP의 적용 단계

- 미리 준비된 AOP 이용
    - `@Transactional`, `@Configurable` …

## 8.4.3 포터블 서비스 추상화 (PSA)

---

**환경과 세부 기술의 변화에 관계없이 일관된 방식으로 기술에 접근할 수 있게 해주는 PSA이다.**

POJO코드가 세부 기술 변화에 직접 노출되어 만들어 지지 않게 된다. 

### 트랜잭션 서비스 추상화

트랜잭션은 대부분 AOP를 이용해 만들기 때문에 직접 사용할 일이 없다. 설정에서 스프링의 트랜잭션 추상화 인터페이스인 `PlatformTransactionManager`를 구현한 구체적인 서비스 클래스를 빈으로 등록해줘야 한다. 

```xml
<bean id="transactionManager"
      class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
    <property name="dataSource" ref="dataSource"/>
</bean>
```

### 직접 스프링이 제공하는 API

스프링이 정의한 추상 API를 이용해 코드를 작성하고, 구체적인 기술과 설정은 XML 파일 안에서 지정한다.

### 서비스 추상화와 DI

서비스 추상화를 위해 필요한 기술은 DI 뿐이다.
